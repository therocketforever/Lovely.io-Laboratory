/**
 * lovely.io 'fx' module v1.0.3
 *
 * Copyright (C) 2011 Nikolay Nemshilov
 */
Lovely("fx-1.0.3",["dom-1.1.0"],function(a){var b=this,c={},d,e,f,g,h,i,Class,j,Fx,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,c,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y;E=this.Lovely.module("core"),d=this.Lovely.module("dom-1.1.0"),G=E.ext,z=E.bind,Class=E.Class,x=E.List,v=E.Hash,J=E.isObject,j=d.Element,h=d.Browser,u=b.document.documentElement,w="filter"in u.style&&!("opacity"in u.style),Fx=new Class({include:[E.Options,E.Events],extend:{Options:{duration:"normal",transition:"default",queue:!0,engine:"css",fps:60},Durations:{"short":200,normal:400,"long":800}},constructor:function Fx(a,b){var c;this.setOptions(b);for(c in this.options)(c==="start"||c==="finish"||c==="cancel"||c==="stop")&&this.on(c,this.options[c]);return this.element=d(a),typeof a==="string"&&(this.element=this.element[0]),n(this),this},start:function(){return k(this,arguments)?this:(m(this),this.prepare.apply(this,arguments),s(this),this.emit("start"))},finish:function(){return t(this),o(this),this.emit("finish"),p(this),this},cancel:function(){return t(this),o(this),this.emit("cancel").emit("stop")},emit:function(a){return E.Events.emit.apply(this,arguments),this.element.emit("fx:"+a,{fx:this}),this}}),r=new x,q=new x,n=function(a){var b;return b=d.uid((a.element||{})._||{}),a._ch=r[b]=r[b]||new x,a._cr=q[b]=q[b]||new x},k=function(a,b){var c,d;return c=a._ch,d=a.options.queue,!c||a._$ch?a._$ch=!1:(d&&c.push([b,a]),d&&c[0][1]!==a)},m=function(a){if(a._cr)return a._cr.push(a)},o=function(a){var b;b=a._cr;if(b)return b.splice(b.indexOf(a),1)},p=function(a){var b,c;b=a._ch,c=b.shift(),(c=b[0])?(c[1]._$ch=!0,c[1].start.apply(c[1],c[0])):a.emit("stop")},l=function(a){var b;b=d.uid(a._),q[b]&&q[b].forEach("cancel"),Fx_scheduled_fx[b]&&Fx_scheduled_fx[b].splice(0)},s=function(a,b){var c,d,e,f,h;return b=a.options,c=Fx.Durations[b.duration]||b.duration,f=Math.ceil(c/1e3*b.fps),h=g(b.transition,f),d=Math.round(1e3/b.fps),e=0,a._timer=setInterval(function(){return e===f?a.finish():(a.render(h[e]),e++)},d)},t=function(a){if(a._timer)return clearInterval(a._timer)},f={"default":"(.25,.1,.25,1)",linear:"(0,0,1,1)","ease-in":"(.42,0,1,1)","ease-out":"(0,0,.58,1)","ease-in-out":"(.42,0,.58,1)","ease-out-in":"(0,.42,1,.58)"},e={},g=function(a,b){var c,d,g,h,i,j,k,l,m,n,o,p,q,r;a=f[a]||a,a=a.match(/([\d\.]+)[\s,]+([\d\.]+)[\s,]+([\d\.]+)[\s,]+([\d\.]+)/),a=[0,a[1]-0,a[2]-0,a[3]-0,a[4]-0],o=a.join(",")+","+b;if(!(o in e)){i=3*a[1],g=3*(a[3]-a[1])-i,c=1-i-g,j=3*a[2],h=3*(a[4]-a[2])-j,d=1-j-h,k=function(a){return a*(i+a*(g+a*c))},m=function(a){return a*(j+a*(h+a*d))},l=function(a){return i+a*(2*g+a*3*c)+.001},n=function(a){var b,c,d,e;d=a,b=0,c=5;while(b<5){e=k(d)-a;if(Math.abs(e)<.001)break;d=d-e/l(d),b++}return d},e[o]=p=[],r=0,q=1/b;while(r<1.0001)p.push(m(n(r))),r+=q}return e[o]},Fx.Attr=new Class(Fx,{prepare:function(a){var b,c;this.before={},this.after=a,b=this.element._;for(c in a)this.before[c]=b[c]},render:function(a){var b,c,d,e;d=this.element._,c=this.before,b=this.after;for(e in c)d[e]=c[e]+(b[e]-c[e])*a}}),Fx.Scroll=new Class(Fx.Attr,{constructor:function(a,b){var c;return this.$super(a,b),this.element instanceof d.Window&&(c=this.element._.document,this.element=c.body||c.documentElement),this},prepare:function(a){var b;return b={},"x"in a&&(b.scrollLeft=a.x),"y"in a&&(b.scrollTop=a.y),this.$super(b)}}),Fx.Style=new Class(Fx,{prepare:function(a){var b,c,d;this.options.engine==="css"&&O!==null?(this.render=function(){},P.call(this,a)):(d=T(a),c=D(this.element,d),b=I(this.element,a,d),C(this.element,c,b),this.before=S(c),this.after=S(b))},render:function(a){var b,c,d,e=this.element._.style,f=Math.round,g,h,i;for(g in this.after){b=this.before[g],c=this.after[g];for(h=0,i=c.length;h<i;h++)d=b[h]+(c[h]-b[h])*a,c.r&&(d=Math.round(d)),c.t[h*2+1]=d;e[g]=c.t.join("")}}}),O=null,Y=["WebkitT","OT","MozT","MsT","t"];for(W=0,X=Y.length;W<X;W++){L=Y[W];if(""+L+"ransition"in u.style){O=L;break}}return R=O+"ransition",Q=R+"Property",M=R+"Duration",N=R+"TimingFunction",P=function(a){var b,c,d,e,f;return e=this.options,b=this.element,d=b.style(""+Q+","+M+","+N),c=b._.style,f=function(){var a,b;b=[];for(a in d)b.push(c[a]=d[a]);return b},this.on({finish:f,cancel:function(){return c[Q]="none",setTimeout(f,1)}}),setTimeout(function(){return c[Q]="all",c[N]=e.transition,c[M]=(Fx.Durations[e.duration]||e.duration)+"ms",setTimeout(function(){return b.style(a)},0)},0)},Fx.Options.engine=O===null||h==="Opera"?"javascript":"css",F=["Top","Left","Right","Bottom"],y=function(a,b,c){var d,e,f;for(e=0,f=c.length;e<f;e++)d=c[e],a.push(b+d)},T=function(a){var b,c,d,e,f,g,h,i,j;d=[];for(c in a)if(c.substr(0,6)==="border"){j=["Style","Color","Width"];for(f=0,h=j.length;f<h;f++){e=j[f];for(g=0,i=F.length;g<i;g++)b=F[g],d.push("border"+b+e)}}else c==="margin"||c==="padding"?y(d,c,F):c.substr(0,10)==="background"?y(d,"background",["Color","Position","PositionX","PositionY"]):c==="opacity"&&w?d.push("filter"):d.push(c);return d},K=function(a){return a==="transparent"||a==="rgba(0, 0, 0, 0)"},B=function(b,c,d){var e,f,g,h,i,j,k,l;l=[];for(j=0,k=F.length;j<k;j++)h=F[j],f="border"+h+"Style",g="border"+h+"Width",e="border"+h+"Color",l.push(f in c&&c[f]!==d[f]?(i=b._.style,c[f]==="none"?i[g]="0px":a,i[f]=d[f],K(c[e])?i[e]=b.style("Color"):a):void 0);return l},S=function(a){var b,c,d,e,f,g,h,i,j,k,l;f={},e=/[\d\.\-]+/g;for(d in a){h=[],l=a[d].match(e);for(i=0,j=l.length;i<j;i++)b=l[i],h.push(parseFloat(b));h.t=a[d].split(e),h.r=h.t[0]==="rgb(",h.t.length===1&&h.t.unshift("");for(c=0,k=h.length;c<k;c++)g=h[c],h.t.splice(c*2+1,0,g);f[d]=h}return f},C=function(b,c,d){var e,f;for(e in d)(e==="width"||e==="height")&&c[e]==="auto"&&(e[0]=e[0].toUpperCase(),c[e]=b._["offset"+e]+"px");w&&d.filter&&!c.filter&&(c.filter="alpha(opacity=100)"),B(b,c,d),f=[];for(e in d){if(d[e]!==c[e]&&/color/i.test(e)){K(d[e])||(d[e]=V(d[e])),K(c[e])||(c[e]=V(c[e]));if(!d[e]||!c[e])d[e]=c[e]=""}/\d/.test(d[e])&&!/\d/.test(c[e])&&(c[e]=d[e].replace(/[\d\.\-]+/g,"0")),f.push(d[e]===c[e]||!/\d/.test(c[e])||!/\d/.test(d[e])?(delete d[e],delete c[e]):a)}return f},D=function(b,c){var d,e,f,g,h;e={};for(g=0,h=c.length;g<h;g++)d=c[g],f=b.style(d),f!==a&&(e[d]=""+f),d==="opacity"&&(e[d]=e[d].replace(",","."));return e},I=function(a,b,c){var d,e;return e=a.clone(),e.style("position:absolute;z-index:-1;visibility:hidden"),e.size({x:a.size().x}),e.style(b),a.parent()&&a.insert(e,"before"),d=D(e,c),e.remove(),d},Fx.Highlight=new Class(Fx.Style,{extend:{Options:v.merge(Fx.Options,{color:"#FF8",transition:"ease-out"})},prepare:function(a,b){var c,d,e,f;return c=this.element,d=c._.style,f="backgroundColor",e=b||c.style(f),K(e)&&(this.on("finish",function(){return d[f]="transparent"}),e=(new x([c])).concat(c.parents()).map("style",f).reject(function(a){return!a||K(a)}),e=e[0]||"#FFF"),d[f]=a||this.options.color,this.$super({backgroundColor:e})}}),Fx.Twin=new Class(Fx.Style,{finish:function(){return this.direction==="out"&&j.prototype.hide.call(this.element),this.$super()},setDirection:function(a){if(!a||a==="toggle")a=this.element.visible()?"out":"in";this.direction=a}}),Fx.Fade=new Class(Fx.Twin,{prepare:function(a){return this.setDirection(a),this.direction==="in"&&j.prototype.show.call(this.element.style({opacity:0})),this.$super({opacity:this.direction==="in"?1:0})}}),Fx.Slide=new Class(Fx.Twin,{extend:{Options:v.merge(Fx.Options,{direction:"top"})},prepare:function(a){var b,c,d,e,f;return this.setDirection(a),b=j.prototype.show.call(this.element),c=b._.style,e=b.style("overflow,width,height,marginTop,marginLeft"),f=function(){return G(c,e)},this.on("finish,cancel",f),c.overflow="hidden",d=H(c,b.size(),this.options.direction,this.direction),this.$super(d)}}),H=function(a,b,c,d){var e,f,g,h,i,j;return g={},e=parseFloat(a.marginLeft)||0,f=parseFloat(a.marginTop)||0,i=c==="right",h=c==="bottom",j=c==="top"||h,d==="out"?(g[j?"height":"width"]="0px",i?g.marginLeft=e+b.x+"px":h&&(g.marginTop=f+b.y(NaN))):(j?(g.height=b.y+"px",a.height="0px"):(g.width=b.x+"px",a.width="0px"),i?(g.marginLeft=e+"px",a.marginLeft=e+b.x+"px"):h&&(g.marginTop=f+"px",a.marginTop=f+b.y+"px")),g},j.include({animate:function(a,b){return(new Fx.Style(this,b)).start(a),this},stopFx:function(){return l(this),this},show:function(a,b){return A(this,a,b,this.$super,"show")},hide:function(a,b){return A(this,a,b,this.$super,"hide")},toggle:function(a,b){return A(this,a,b,this.$super,"toggle")},remove:function(a,b){return A(this,a,b,this.$super,"remove")},fade:function(a,b){return(new Fx.Fade(this,b)).start(a),this},slide:function(a,b){return(new Fx.Slide(this,b)).start(a),this},highlight:function(a,b,c){return(new Fx.Highlight(this,c)).start(a,b),this},scroll:function(a,b){return J(b)?(new Fx.Scroll(this,b)).start(a):this.$super(a,b),this}}),A=function(a,b,c,d,e){return(e!=="show"||!a.visible())&&(e!=="hide"||!a.hidden())&&(typeof b==="string"?(b=b[0].toUpperCase()+b.slice(1),b=new Fx[b](a,c),e==="remove"&&b.on("finish",function(){return a.remove()}),b.start()):d.call(a)),a},V=function(a,b){var c,d;return d=/#([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})/i.exec(U(a)||""),d&&(d=function(){var a,b,e,f;e=d.slice(1),f=[];for(a=0,b=e.length;a<b;a++)c=e[a],f.push(parseInt(c,16));return f}(),d=b?d:"rgb("+d+")"),d},U=function(a){var b,c,d,e,f;c=/^#(\w)(\w)(\w)$/.exec(a);if(c)c="#"+c[1]+c[1]+c[2]+c[2]+c[3]+c[3];else if(c=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/.exec(a)){d=c.slice(1),c="#";for(e=0,f=d.length;e<f;e++)b=d[e],b=(b-0).toString(16),c+=b.length===1?"0"+b:b}else c=i[a]||a;return c},i={maroon:"#800000",red:"#ff0000",orange:"#ffA500",yellow:"#ffff00",olive:"#808000",purple:"#800080",fuchsia:"#ff00ff",white:"#ffffff",lime:"#00ff00",green:"#008000",navy:"#000080",blue:"#0000ff",aqua:"#00ffff",teal:"#008080",black:"#000000",silver:"#c0c0c0",gray:"#808080",brown:"#a52a2a"},c=G(Fx,{version:"1.0.3"}),c})