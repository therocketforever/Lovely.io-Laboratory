/**
 * lovely.io 'core' module v1.1.0
 *
 * Copyright (C) 2012 Nikolay Nemshilov
 */
((function(a){var b=this,c,d,e,f,g,h,i,j,k,l,Class,Events,m,n,Hash,o,List,p,Lovely,q,Options,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H=Object.prototype.hasOwnProperty;Lovely=function(){var a,b,d,e,f,g,h,i,j,k,l,m,n,o,p;a=c(arguments),e=D(a[0])?a.shift():null,l=C(a[0])?a.shift():{},j=z(a[0])?a.shift():[],b=A(a[0])?a.shift():function(){},f=new Date,"hostUrl"in l||(l.hostUrl=Lovely.hostUrl||x()),"baseUrl"in l||(l.baseUrl=Lovely.baseUrl||l.hostUrl),"waitSeconds"in l||(l.waitSeconds=Lovely.waitSeconds),l.hostUrl[l.hostUrl.length-1]==="/"||(l.hostUrl+="/"),l.baseUrl[l.baseUrl.length-1]==="/"||(l.baseUrl+="/"),f.setTime(f.getTime()+l.waitSeconds*1e3);for(h=0,o=j.length;h<o;h++)k=j[h],k in Lovely.bundle&&(j[h]=""+k+"-"+Lovely.bundle[k]);d=E(j,b,e);if(!d()){F.push(d),g=document.getElementsByTagName("head")[0];for(h=0,p=j.length;h<p;h++)i=j[h],n=(i[0]==="."?l.baseUrl:l.hostUrl)+i+".js",i=j[h]=j[h].replace(/^[\.\/]+/,""),!y(i)&&!y(i,Lovely.loading)&&(m=document.createElement("script"),m.src=n.replace(/([^:])\/\//g,"$1/"),m.async=!0,m.type="text/javascript",m.onload=t,g.appendChild(m),Lovely.loading[i]=m)}},F=[],t=function(){return b.setTimeout(function(){var a,b,c,d;a=[];for(b=0,d=F.length;b<d;b++)c=F[b],c()||a.push(c);a.length!==F.length&&(F=a,t())},0)},E=function(a,c,d){return function(){var e,f,g,h,i;f=[];for(h=0,i=a.length;h<i;h++){e=a[h];if(e=y(e))f.push(e);else return!1}return(g=c.apply(b,f))&&d&&(Lovely.modules[d]=g,delete Lovely.loading[d]),!0}},y=function(a,b){var c,d,e,f,g;b=b||Lovely.modules,f=(a.match(/\-\d+\.\d+\.\d+.*$/)||[""])[0],e=a.substr(0,a.length-f.length),f=f.substr(1);if(!(a=b[a])){g=[];for(c in b)(d=c.match(/^(.+?)-(\d+\.\d+\.\d+.*?)$/))&&d[1]===e&&g.push(c);a=b[g.sort()[g.length-1]]}return a},x=function(){var a,c,d,e,f,g;if(b.document){e=document.getElementsByTagName("script"),c=/^(.*?\/?)core(-.+)?\.js/;for(f=0,g=e.length;f<g;f++){d=e[f];if(a=(d.getAttribute("src")||"").match(c))return a[1]}}return Lovely.hostUrl},q=Object.prototype.toString,j=Array.prototype.slice,m=Function.prototype.bind||function(){var a,b,d;return a=c(arguments),b=a.shift(),d=this,function(){return d.apply(b,a.concat(c(arguments)))}},r=String.prototype.trim||function(){var a,b,c;c=this.replace(/^\s\s*/,""),a=c.length,b=/\s/;while(b.test(c.charAt(--a)));return c.slice(0,a+1)},c=function(a){return j.call(a,0)},o=function(a){return new List(a)},n=function(a){return new Hash(a)},w=function(a,b){b==null&&(b={});var c;for(c in b){if(!H.call(b,c))continue;a[c]=b[c]}return a},s=function(){var a;return a=c(arguments),m.apply(a.shift(),a)},G=function(a){return r.call(a)},D=function(a){return typeof a==="string"},B=function(a){return typeof a==="number"&&!isNaN(a)},A=function(a){return typeof a==="function"&&q.call(a)!=="[object RegExp]"},z=function(a){return q.call(a)==="[object Array]"||a instanceof List},C=function(a){return q.call(a)==="[object Object]"},u=function(a){return z(a)?a:[a]},Class=function(b,c){var d,e;return A(b)||(c=b,b=null),c||(c={}),d=function(){return this.$super===a?this:this.$super.apply(this,arguments)},H.call(c,"constructor")&&(d=c.constructor),b&&(e=function(){},e.prototype=b.prototype,d.prototype=new e,d.__super__=b,d.prototype.$super=function(){return this.$super=b.prototype.$super,b.apply(this,arguments)}),d.prototype.constructor=d,(d.include=Class.include).apply(d,u(c.include||[])),(d.extend=Class.extend).apply(d,u(c.extend||[])),delete c.extend,delete c.include,delete c.constructor,d.include(c)},w(Class,{include:function(){var a,b,c,d,e,f,g;for(f=0,g=arguments.length;f<g;f++){c=arguments[f],c||(c={});for(a in c){if(!(e=this.prototype[a]||!1)){d=this.__super__;while(d){if(a in d.prototype){A(d.prototype[a])&&(e=d.prototype[a]);break}d=d.__super__}}b=c[a],this.prototype[a]=function(a,b){return b?function(){return this.$super=b,a.apply(this,arguments)}:a}(b,e)}}return this},extend:function(){var a,b,c;for(b=0,c=arguments.length;b<c;b++)a=arguments[b],w(this,a);return this}}),List=new Class(Array,{constructor:function List(b){return b!==a&&l.apply(this,[0,0].concat(b)),this},slice:function(){return new this.constructor(j.apply(this,arguments))},concat:function(a){return new this.constructor(c(this).concat(c(a)))},forEach:function(){return p(f,this,arguments),this},map:function(){return new List(p(g,this,arguments))},filter:function(){return new this.constructor(p(e,this,arguments))},reject:function(){return new this.constructor(p(i,this,arguments))},some:function(){return p(k,this,arguments)},every:function(){return p(d,this,arguments)},toArray:function(){return c(this)},toString:function(){return"#<List ["+c(this)+"]>"}}),h=Array.prototype,j=h.slice,l=h.splice,f=h.forEach,g=h.map,e=h.filter,i=function(a,b){return e.call(this,function(){return!a.apply(b,arguments)})},k=h.some,d=h.every,p=function(a,b,d){var e,f;return typeof d[0]=="string"&&(f=c(d),e=f.shift(),b.length!==0&&typeof b[0][e]=="function"?d=[function(a){return a[e].apply(a,f)}]:d=[function(a){return a[e]}]),a.apply(b,d)},Hash=new Class({_:null,constructor:function Hash(a){return this._=a||{},this}}),Hash.include=function(a){var b,d;Class.include.apply(Hash,arguments),d=[];for(b in a)d.push(function(a){return Hash[a]=function(){var b,d;return b=c(arguments),d=new Hash(b.shift()),b=d[a].apply(d,b),b instanceof Hash&&(b=b._),b}}(b));return d},Hash.include({keys:function(){var a,b,c;b=this._,c=[];for(a in b){if(!H.call(b,a))continue;c.push(a)}return c},values:function(){var a,b,c,d;c=this._,d=[];for(a in c){if(!H.call(c,a))continue;b=c[a],d.push(b)}return d},empty:function(){var a,b;b=this._;for(a in b){if(!H.call(b,a))continue;return!1}return!0},clone:function(){return this.merge()},forEach:function(a,b){var c,d,e;d=this._;for(c in d){if(!H.call(d,c))continue;e=d[c],a.call(b,c,e,d)}return this},map:function(a,b){var c,d,e,f;d=this._,e=[];for(c in d){if(!H.call(d,c))continue;f=d[c],e.push(a.call(b,c,f,d))}return e},filter:function(a,b){var c,d,e,f;e=this._,c={};for(d in e){if(!H.call(e,d))continue;f=e[d],a.call(b,d,f,e)&&(c[d]=e[d])}return new Hash(c)},reject:function(a,b){var c,d,e,f;e=this._,c={};for(d in e){if(!H.call(e,d))continue;f=e[d],a.call(b,d,f,e)||(c[d]=e[d])}return new Hash(c)},merge:function(){var a,b,d,e,f;a=c(arguments),b={},a.unshift(this._);while(a.length>0){e=a.shift(),e instanceof Hash&&(e=e._);for(d in e){if(!H.call(e,d))continue;f=e[d],b[d]=C(f)?Hash.merge(d in b?b[d]:{},f):e[d]}}return new Hash(b)},toObject:function(){return this._}}),Events={_listeners:null,on:function(){var a,b,d,e,f,g,h;a=c(arguments),e=a.shift(),b=a.shift(),typeof b==="string"&&(b=this[b]),this._listeners===null&&(this._listeners=[]);switch(typeof e){case"string":h=e.split(",");for(f=0,g=h.length;f<g;f++)d=h[f],this._listeners.push({e:d,c:b,a:a,n:typeof arguments[1]=="string"});break;case"object":for(d in e)this.on(d,e[d])}return this},no:function(){var b,d,e,f,g,h,i,j;b=c(arguments),f=b.shift(),d=b.shift(),typeof d==="string"&&(d=this[d]),this._listeners===null&&(this._listeners=[]);switch(typeof f){case"string":j=f.split(",");for(h=0,i=j.length;h<i;h++){e=j[h],g=0;while(g<this._listeners.length)this._listeners[g].e===e&&(this._listeners[g].c===d||d===a)&&this._listeners.splice(g--,1),g++}break;case"function":g=0;while(g<this._listeners.length)this._listeners[g].c===f&&this._listeners.splice(g--,1),g++;break;case"object":for(e in f)this.no(e,f[e])}return this},ones:function(){var b,d,e,f,g,h,i,j,k,l,m,n,o,p,q;h=!1,b=c(arguments),g=b.shift(),d=b.shift(),typeof d==="string"&&(d=this[d]),this._listeners===null&&(this._listeners=[]);switch(typeof g){case"string":o=g.split(",");for(i=0,l=o.length;i<l;i++){f=o[i],p=this._listeners;for(j=0,m=p.length;j<m;j++)e=p[j],h|=e.e===f&&(e.c===d||d===a)}break;case"function":q=this._listeners;for(k=0,n=q.length;k<n;k++)e=q[k],h|=e.c===g;break;case"object":for(f in g)h|=this.ones(f,g[f])}return h===1},emit:function(){var a,b,d,e,f,g;a=c(arguments),d=a.shift(),g=this._listeners||[];for(e=0,f=g.length;e<f;e++)b=g[e],b.e===d&&b.c.apply(this,b.a.concat(a));return this}},Options={options:{},setOptions:function(a){var b,c;c=this.constructor,b={};while(c){if("Options"in c){b=c.Options;break}c=c.__super__}return this.options=Hash.merge(b,a),this}},v=w(Lovely,{version:"1.1.0",modules:{},loading:{},baseUrl:"",hostUrl:"",module:y,bundle:{},A:c,L:o,H:n,ext:w,bind:s,trim:G,isString:D,isNumber:B,isFunction:A,isArray:z,isObject:C,Class:Class,List:List,Hash:Hash,Events:Events,Options:Options}),Lovely.modules["core-"+Lovely.version]=Lovely,b.Lovely=Lovely})).apply(this)